<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rupp.assignment.dao.CourseRoomDao">
	
	<resultMap type='com.rupp.assignment.json.JCourseRoom' id='JCourseRoomResult'>

		<id property='id' column='id' />
		<result property='createdDate' column='created_date' />
		<result property='modifiedDate' column='modified_date' />
		<association property="createdBy"
                 column="created_by"
                 javaType="com.rupp.assignment.json.JUser"
                 select="com.rupp.assignment.dao.UserDao.findById"/>
		<association property="modifiedBy"
                 column="modified_by"
                 javaType="com.rupp.assignment.json.JUser"
                 select="com.rupp.assignment.dao.UserDao.findById"/>
        <association property="courseID"
                     column="course_id"
                     javaType="com.rupp.assignment.json.JCourse"
                     select="com.rupp.assignment.dao.CourseDao.findById"/>
        <association property="roomID"
                     column="room_id"
                     javaType="com.rupp.assignment.json.JRoom"
                     select="com.rupp.assignment.dao.RoomDao.findById"/>
	</resultMap>
	
  <insert id="add"
        parameterType="com.rupp.assignment.json.JCourseRoom"
        useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO courses_rooms (
        	course_id,
        	room_id,
        	created_date,
			created_by
        )
        VALUES (
         #{courseID},
         #{roomID},
         #{createdDate},
         #{createdBy}
         )
    </insert>

 	<delete id="removeAllCourseID"
        parameterType="int">
        DELETE FROM courses_rooms
        WHERE courseID = #{courseID}
    </delete>

    <delete id="removeAllRoomID"
            parameterType="int">
        DELETE FROM courses_rooms
        WHERE roomID = #{roomID}
    </delete>

    <delete id="removeCourseIDRoomID"
            parameterType="map">
        DELETE FROM courses_rooms
        WHERE roomID = #{roomID} AND courseID = #{courseID}
    </delete>

    <select id="getByCourseID" parameterType="int"  resultMap="JCourseRoomResult" >
        SELECT *
        FROM courses_rooms
        WHERE course_id = #{courseID}
    </select>

    <select id="getByRoomID" parameterType="int"  resultMap="JCourseRoomResult" >
        SELECT *
        FROM courses_rooms
        WHERE room_id = #{roomID}
    </select>

    <select id='getAll' parameterType="map" resultMap="JCourseRoomResult" >
        SELECT *
        FROM courses_rooms
    </select>
    
    <select id="getPage" parameterType="map" resultMap="JCourseRoomResult">
        SELECT *
        FROM courses_rooms
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <select id="count" resultType="int">
        SELECT COUNT(*) 
        FROM courses_rooms
    </select>
</mapper>
